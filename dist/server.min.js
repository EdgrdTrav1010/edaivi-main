"use strict";function ownKeys(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(r,!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(r).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var express=require("express"),_require=require("socket.io"),Server=_require.Server,_require2=require("http"),createServer=_require2.createServer,mongoose=require("mongoose"),cors=require("cors"),path=require("path"),app=express(),httpServer=createServer(app),io=new Server(httpServer,{cors:{origin:"production"===process.env.NODE_ENV?process.env.FRONTEND_URL:["http://localhost:3000","http://localhost:3001"],methods:["GET","POST"],credentials:!0}}),PORT=process.env.PORT||8082,MONGODB_URI=process.env.MONGODB_URI||"mongodb://localhost:27017/edaivi",User=require("./models/User"),AudioProject=require("./models/AudioProject"),VideoProject=require("./models/VideoProject"),Avatar3D=require("./models/Avatar3D"),Scene3D=require("./models/Scene3D"),StreamSession=require("./models/StreamSession"),AIModel=require("./models/AIModel");console.log("📦 MongoDB connection skipped - using mock data for testing");var mockUsers=[{_id:"user1",email:"admin@edaivi.com",displayName:"Admin User",role:"admin",isVerified:!0,avatar:"default-avatar.png",subscription:{plan:"enterprise"},usage:{aiCredits:1e3},comparePassword:function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}})}},{_id:"user2",email:"edgrd.88@gmail.com",displayName:"Developer",role:"admin",isVerified:!0,avatar:"default-avatar.png",subscription:{plan:"enterprise"},usage:{aiCredits:1e3},comparePassword:function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}})}}];User.findOne=function(t){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.email)return e.abrupt("return",mockUsers.find(function(e){return e.email===t.email}));e.next=2;break;case 2:return e.abrupt("return",null);case 3:case"end":return e.stop()}})},User.findById=function(t){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",mockUsers.find(function(e){return e._id===t}));case 1:case"end":return e.stop()}})},User.prototype.updateAiCredits=function(t){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return this.usage.aiCredits+=t,e.abrupt("return",this);case 2:case"end":return e.stop()}},null,this)},User.prototype.save=function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this);case 1:case"end":return e.stop()}},null,this)};var mockAIModels=[{_id:"model1",name:"text-gen-basic",displayName:"TextGen Basic",description:"Базовая модель генерации текста",type:"text-generation",category:"text",isActive:!0,creditsPerUse:1,costPerUse:.01,restrictions:{minUserLevel:"free"},updateUsageStats:function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}})}},{_id:"model2",name:"image-gen-basic",displayName:"ImageGen Basic",description:"Базовая модель генерации изображений",type:"image-generation",category:"image",isActive:!0,creditsPerUse:2,costPerUse:.02,restrictions:{minUserLevel:"free"},updateUsageStats:function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}})}},{_id:"model3",name:"tts-basic",displayName:"TTS Basic",description:"Базовая модель преобразования текста в речь",type:"text-to-speech",category:"audio",isActive:!0,creditsPerUse:1,costPerUse:.01,restrictions:{minUserLevel:"free"},updateUsageStats:function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}})}}];AIModel.find=function(t){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",mockAIModels.filter(function(e){return(void 0===t.isActive||e.isActive===t.isActive)&&((!t.category||e.category===t.category)&&((!t.type||e.type===t.type)&&!(t.isFeatured&&!e.isFeatured)))}));case 1:case"end":return e.stop()}})},AIModel.findById=function(t){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",mockAIModels.find(function(e){return e._id===t}));case 1:case"end":return e.stop()}})};var mockAudioProjects=[{_id:"project1",title:"Демо проект 1",description:"Тестовый аудио проект",owner:"user1",isPublic:!0,tracks:[],duration:0,bpm:120,addTrack:function(t){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return this.tracks.push(t),e.abrupt("return",this);case 2:case"end":return e.stop()}},null,this)},removeTrack:function(t){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return this.tracks=this.tracks.filter(function(e){return e._id!==t}),e.abrupt("return",this);case 2:case"end":return e.stop()}},null,this)},updateTrack:function(t,r){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return-1!==(n=this.tracks.findIndex(function(e){return e._id===t}))&&(this.tracks[n]=_objectSpread({},this.tracks[n],{},r)),e.abrupt("return",this);case 3:case"end":return e.stop()}},null,this)},export:function(t,r){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{url:"https://example.com/export_".concat(this._id,".").concat(t||"mp3"),format:t||"mp3",quality:r||"high",duration:this.duration,fileSize:1e6,createdAt:new Date});case 1:case"end":return e.stop()}},null,this)},save:function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this);case 1:case"end":return e.stop()}},null,this)}}];AudioProject.find=function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",mockAudioProjects);case 1:case"end":return e.stop()}})},AudioProject.findById=function(t){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",mockAudioProjects.find(function(e){return e._id===t}));case 1:case"end":return e.stop()}})};var authRoutes=require("./routes/auth"),audioRoutes=require("./routes/audio"),aiRoutes=require("./routes/ai");app.use(cors({origin:"production"===process.env.NODE_ENV?process.env.FRONTEND_URL:["http://localhost:3000","http://localhost:3001"],credentials:!0})),app.use(express.json({limit:"50mb"})),app.use(express.urlencoded({extended:!0,limit:"50mb"})),app.use(express.static(path.join(__dirname,"client"))),app.use("/api/auth",authRoutes),app.use("/api/audio",audioRoutes),app.use("/api/ai",aiRoutes),app.get("/",function(e,t){t.sendFile(path.join(__dirname,"client","index.html"))}),app.get("/api",function(e,t){t.json({message:"EdAiVi Studio API запущен!",version:"1.0.0",status:"working",timestamp:(new Date).toISOString(),endpoints:["GET /","GET /api/status","POST /api/auth/login","POST /api/auth/register","GET /api/auth/profile","GET /api/audio","GET /api/video","GET /api/avatar","GET /api/scene","GET /api/stream","GET /api/ai"]})}),app.get("/api/status",function(e,t){t.json({status:"online",uptime:process.uptime(),memory:process.memoryUsage(),environment:process.env.NODE_ENV||"development",mongodb:1===mongoose.connection.readyState?"connected":"disconnected",timestamp:(new Date).toISOString()})}),io.on("connection",function(r){console.log("🔌 Socket connected: ".concat(r.id)),r.on("join-room",function(e,t){r.join(e),r.to(e).emit("user-connected",t),console.log("👤 User ".concat(t," joined room ").concat(e))}),r.on("leave-room",function(e,t){r.leave(e),r.to(e).emit("user-disconnected",t),console.log("👤 User ".concat(t," left room ").concat(e))}),r.on("chat-message",function(e,t){r.to(e).emit("chat-message",t)}),r.on("project-update",function(e,t){r.to(e).emit("project-update",t)}),r.on("stream-event",function(e,t){r.to(e).emit("stream-event",t)}),r.on("disconnect",function(){console.log("🔌 Socket disconnected: ".concat(r.id))})}),app.use("*",function(e,t){t.status(404).json({error:"Маршрут не найден",path:e.originalUrl,method:e.method,timestamp:(new Date).toISOString(),availableRoutes:["GET /","GET /api/status","POST /api/auth/login","POST /api/auth/register","GET /api/auth/profile","GET /api/audio","GET /api/video","GET /api/avatar","GET /api/scene","GET /api/stream","GET /api/ai"]})}),app.use(function(e,t,r,n){console.error("❌ Ошибка сервера:",e.stack),r.status(500).json({error:"Внутренняя ошибка сервера",message:e.message,timestamp:(new Date).toISOString()})}),httpServer.listen(PORT,function(){console.log("=".repeat(50)),console.log("🚀 Сервер EdAiVi Studio запущен!"),console.log("📡 Порт: ".concat(PORT)),console.log("🌐 URL: http://localhost:".concat(PORT)),console.log("⏰ Время запуска: ".concat((new Date).toLocaleString())),console.log("🔌 Socket.IO активен"),console.log("🌍 Окружение: ".concat(process.env.NODE_ENV||"development")),console.log("=".repeat(50)),console.log("📋 Доступные маршруты:"),console.log("   GET  http://localhost:".concat(PORT,"/")),console.log("   GET  http://localhost:".concat(PORT,"/api/status")),console.log("   POST http://localhost:".concat(PORT,"/api/auth/login")),console.log("   POST http://localhost:".concat(PORT,"/api/auth/register")),console.log("   GET  http://localhost:".concat(PORT,"/api/auth/profile")),console.log("   GET  http://localhost:".concat(PORT,"/api/audio")),console.log("   GET  http://localhost:".concat(PORT,"/api/video")),console.log("   GET  http://localhost:".concat(PORT,"/api/avatar")),console.log("   GET  http://localhost:".concat(PORT,"/api/scene")),console.log("   GET  http://localhost:".concat(PORT,"/api/stream")),console.log("   GET  http://localhost:".concat(PORT,"/api/ai")),console.log("=".repeat(50))}),module.exports=app;
//# sourceMappingURL=server.min.js.map
